#!/bin/bash

if [ "$1" = "mic" ]; then
    dev="@DEFAULT_AUDIO_SOURCE@"
    muted="microphone-disabled-symbolic.symbolic"
    high="microphone-sensitivity-high-symbolic.symbolic"
    shift
else
    dev="@DEFAULT_AUDIO_SINK@"
    muted="audio-volume-muted-symbolic.symbolic"
    high="audio-volume-high-symbolic.symbolic"
fi

if [ "$1" = "mute" ]; then
    wpctl set-mute "$dev" toggle
else
    wpctl set-volume -l 1.5 "$dev" $@
fi

output=$(wpctl get-volume "$dev")
volume=$(echo $output | sed 's/^Volume: \([0-9]\)\.\([0-9]\{2\}\).*$/\1\2/')
if [ "$volume" -ge 100 ]; then
    volume="100"
fi

if echo $output | grep -q "MUTED"; then
    dunstify -a "bar-notify" -i "$muted" -r 424242 -h int:value:$volume ""
else
    dunstify -a "bar-notify" -i "$high" -r 424242 -h int:value:$volume ""
fi
